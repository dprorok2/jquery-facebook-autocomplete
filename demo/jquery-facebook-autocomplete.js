!function(a){"use strict";a.autoComplete=function(b,c){var d=[],e=this,f=b,g=f.attr("id"),h={rows:5},i=a.extend({},h,c),j=function(){e.initFriendsList(),e.initKeyboardControls(),e.initDiv()};e.initFriendsList=function(){FB.api("/me/taggable_friends?fields=name,picture",function(a){if(a&&a.data&&!a.error)for(var b=1;b<a.data.length+1;b++){var c={name:a.data[b-1].name,picture:a.data[b-1].picture.data.url};d[b]=c}}),FB.api("/me?fields=name,picture",function(a){if(a&&!a.error){var b={name:a.name,picture:a.picture.data.url};d[0]=b}})},e.initKeyboardControls=function(){a(f).keydown(function(a){13==a.which?e.submit():38==a.which?(a.preventDefault(),a.stopPropagation(),e.moveSelected(-1)):40==a.which?(a.preventDefault(),a.stopPropagation(),e.moveSelected(1)):27==a.keyCode&&e.hideFriends()}).keyup(function(a){13!==a.which&&27!==a.which&&38!==a.which&&40!==a.which&&e.search()}).on("click",function(){e.search()})},e.search=function(){function a(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),a.indexOf(b)>=0}var b=e.findSearchString().searchString;if(void 0===b||null===b||0===b.length)return e.hideFriends();e.showFriends();for(var c=[],f=0,g=0;g<d.length&&f<i.rows;g++)a(d[g].name,b)&&(c.push(d[g]),f++);e.drawFriends(c)},e.submit=function(){var b=e.findSearchString().startingIndex;if(null===b)return e.hideFriends();var c=a(".autocomplete-user-selected").text()||a("."+g+"-autocomplete-user").text();c&&(f.val(f.val().substring(0,b)+c+f.val().substring(f[0].selectionStart)),f.focus(),f[0].selectionStart=b+c.length,f[0].selectionEnd=f[0].selectionStart,e.hideFriends())},e.findSearchString=function(){for(var a=null,b=f[0].selectionStart,c=b-1,d=null,e=null,g=f.val()[c]||"",h=g.toLowerCase();c>=0&&("@"!==e||h&&h>="a"&&"z">=h);)d=e,e=g,g=f.val()[--c]||"",h=g.toLowerCase();return g&&" "!==g||" "===d||"."===d||"@"!==e?c=null:a=f.val().substring(c+1,b).split("@").join(""),{searchString:a,startingIndex:c+1}},e.moveSelected=function(b){var c=a("."+g+"-autocomplete-user").length,d=(a("."+g+"-autocomplete-user.autocomplete-user-selected").index()+b)%c;a(".autocomplete-user-selected").removeClass("autocomplete-user-selected"),a("."+g+"-autocomplete-user").eq(d).addClass("autocomplete-user-selected")},e.initDiv=function(){var b="<div class='autocomplete' id='"+g+"-autocomplete'><ul class='autocomplete-list' id ='"+g+"-autocomplete-list'></ul></div>";f.after(b),a("#"+g+"-autocomplete").css({position:"absolute",left:f.offset().left,width:f.innerWidth(),maxWidth:f.css("max-width")}),a(window).resize(function(){a("#"+g+"-autocomplete").css({left:f.offset().left,width:f.innerWidth()})}),e.hideFriends(),a("#"+g+"-autocomplete-list").on("click",function(){e.submit()}).on("mousedown",function(a){a.preventDefault()}),a(f).focusout(function(){e.hideFriends()}).focusin(function(){e.drawFriends()})},e.drawFriends=function(b){if(e.clearFriends(),!b||0===b.length)return e.hideFriends();for(var c=a(document.createDocumentFragment()),d=0;d<b.length;d++){var f=b[d],h=f.name,i=f.picture,j="<li class='autocomplete-user "+g+"-autocomplete-user' title='"+h+"' role='option'>";j+="<img class='autocomplete-image' src='"+i+"'>",j+="<span class='autocomplete-name'>"+h+"</span>",j+="</li>",c.append(j)}a("#"+g+"-autocomplete-list").append(c),a("."+g+"-autocomplete-user").hover(function(){a(".autocomplete-user-selected").removeClass("autocomplete-user-selected"),a(this).addClass("autocomplete-user-selected")},function(){a(this).removeClass("autocomplete-user-selected")}),0==a("."+g+"-autocomplete-user.autocomplete-user-selected").length&&(a(".autocomplete-user-selected").removeClass("autocomplete-user-selected"),a("#"+g+"-autocomplete .autocomplete-user").eq(0).addClass("autocomplete-user-selected"))},e.clearFriends=function(){a("."+g+"-autocomplete-user").remove()},e.hideFriends=function(){a("#"+g+"-autocomplete").hide()},e.showFriends=function(){a("#"+g+"-autocomplete").show()},j()}}(jQuery);